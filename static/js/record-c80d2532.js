import{_ as C,N as I,x as u,s as k,D as V,r as l,o as c,c as m,d as n,a as h,w as f,F as A,b as S,t as p,f as L,p as M,h as Y}from "./index-7d1d6393.js";const P={name:"record",components:{NavBar:I},data(){return{inputVal:"",list:[],curPage:0,pageSize:50,hasMoreData:!1,loading:!1,userInfo:null,showAdd:!1,showCalendar:!1,form:{strDate:"",sum:""},minDate:new Date(2022,0,1),maxDate:new Date(2023,0,1)}},created(){console.log(u().add(7,"day").toDate()),this.maxDate=u().add(7,"day").toDate(),this.minDate=u().subtract(1,"month").toDate(),this.userInfo=k.getItem("userInfo"),this.onLoadData()},methods:{onLoadData:function(){this.curPage+=1;let o=this;this.loading=!0;let t={userid:this.userInfo.id,index:this.curPage,pageSize:this.pageSize};this.$http.get("/record/queryList",t).then(g=>{let _=g.result,e=_.records,d=_.pages>this.curPage;this.loading=!1;let a=[];this.curPage>1&&(a=o.list),a.length>0&&e.length>0&&(a[a.length-1].diff=a[a.length-1].sum-e[0].sum);for(let r=0; r<e.length; r++){let i=e[r];i.sDate=i.strDate.split(" ")[0],r!==e.length-1?i.diff=i.sum-e[r+1].sum:i.diff=i.sum,a.push(i)}o.list=a,o.hasMoreData=d})},showAddView(){this.form={strDate:u().format("YYYY-MM-DD"),sum:""},this.showAdd=!0},onConfirm(o){this.form.strDate=u(o).format("YYYY-MM-DD"),this.showCalendar=!1},onSubmit(o){if(!o.sum){this.$toast("\u8BF7\u8F93\u5165\u94BB\u77F3\u6570\u91CF");return}if(!/(^[1-9]\d*$)/.test(o.sum)){this.$toast("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u91CF");return}this.$toast.loading({message:"\u4FDD\u5B58\u4E2D...",forbidClick:!0}),this.$http.post("/record/insert",{sum:o.sum,strDate:o.strDate+" 00:00:00",userId:this.userInfo.id}).then(t=>{this.$toast.clear(),t.code===200?(this.showAdd=!1,this.$toast("\u4FDD\u5B58\u6210\u529F"),this.curPage=0,this.onLoadData()):this.$toast(t.msg)})},showAction(o){V.confirm({title:"\u63D0\u793A",message:"\u662F\u5426\u8981\u5220\u9664\u8BE5\u8BB0\u5F55"}).then(()=>{this.$http.delete("/record/deleteById",{id:o.id,userId:o.userId}).then(t=>{t.code===200?(this.showAdd=!1,this.$toast("\u5220\u9664\u6210\u529F"),this.curPage=0,this.onLoadData()):this.$toast(t.msg)})}).catch(()=>{})}}},B= o=>(M("data-v-7d82c197"),o=o(),Y(),o),N={class:"page"},U={class:"page__bd"},z=["onClick"],F={class:"date"},j={class:"sum"},q={key:0,class:"diff",style:{color:"red"}},E={key:1,class:"diff",style:{color:"green"}},T=B(()=>h("div",{class:"title"},"\u65B0\u589E",-1)),G={style:{margin:"16px 16px 48px 16px"}},H=L(" \u63D0\u4EA4 ");function J(o, t, g, _, e, d){const a=l("nav-bar"),r=l("van-list"),i=l("van-icon"),D=l("van-field"),v=l("van-calendar"),w=l("van-cell-group"),b=l("van-button"),y=l("van-form"),x=l("van-popup");return c(),m("view",N,[n(a,{title:"\u5B58\u94BB\u8BB0\u5F55"}),h("view",U,[n(r,{loading:e.loading,"onUpdate:loading":t[0]||(t[0]= s=>e.loading=s),finished:!e.hasMoreData,"finished-text":"\u6CA1\u6709\u66F4\u591A\u4E86",onLoad:d.onLoadData,offset:500,"immediate-check":!0},{default:f(()=>[(c(!0),m(A,null,S(e.list, s=>(c(),m("div",{key:s.id,class:"item",onClick: K=>d.showAction(s)},[h("view",F,p(s.sDate),1),h("view",j,p(s.sum)+"\u94BB",1),s.diff>0?(c(),m("view",q,"+"+p(s.diff)+"\u94BB",1)):(c(),m("view",E,p(s.diff)+"\u94BB",1))],8,z))),128))]),_:1},8,["loading","finished","onLoad"])]),h("div",{class:"fab",onClick:t[1]||(t[1]=(...s)=>d.showAddView&&d.showAddView(...s))},[n(i,{name:"plus"})]),n(x,{show:e.showAdd,"onUpdate:show":t[6]||(t[6]= s=>e.showAdd=s),closeable:"",position:"bottom"},{default:f(()=>[T,n(y,{onSubmit:d.onSubmit},{default:f(()=>[n(w,{inset:""},{default:f(()=>[n(D,{modelValue:e.form.sum,"onUpdate:modelValue":t[2]||(t[2]= s=>e.form.sum=s),name:"sum",label:"\u5B58\u94BB\u6570\u91CF",type:"digit",placeholder:"\u8F93\u5165\u6570\u91CF","input-align":"right"},null,8,["modelValue"]),n(D,{modelValue:e.form.strDate,"onUpdate:modelValue":t[3]||(t[3]= s=>e.form.strDate=s),"is-link":"",readonly:"",name:"strDate",label:"\u5B58\u94BB\u65E5\u671F",placeholder:"\u70B9\u51FB\u9009\u62E9\u65E5\u671F","input-align":"right",onClick:t[4]||(t[4]= s=>e.showCalendar=!0)},null,8,["modelValue"]),n(v,{show:e.showCalendar,"onUpdate:show":t[5]||(t[5]= s=>e.showCalendar=s),onConfirm:d.onConfirm,"min-date":e.minDate,"max-date":e.maxDate},null,8,["show","onConfirm","min-date","max-date"])]),_:1}),h("div",G,[n(b,{round:"",block:"",type:"primary","native-type":"submit"},{default:f(()=>[H]),_:1})])]),_:1},8,["onSubmit"])]),_:1},8,["show"])])}const Q=C(P,[["render",J],["__scopeId","data-v-7d82c197"]]);export{Q as default};
